      - name: Check Date-Time Based Blocking
        run: |
          python3 << 'EOF'
          import datetime
          import os
          
          # Set timezone offset for Iran (+03:30)
          iran_offset = datetime.timedelta(hours=3, minutes=30)
          utc_now = datetime.datetime.utcnow()
          iran_now = utc_now + iran_offset
          
          print(f"UTC time: {utc_now}")
          print(f"Iran time: {iran_now}")
          
          try:
              with open('date_rules.txt', 'r') as f:
                  rules = f.readlines()
              print(f"Found {len(rules)} date rules")
              for rule in rules:
                  if rule.strip() and not rule.startswith('#'):
                      print(f"Rule: {rule.strip()}")
          except FileNotFoundError:
              print("No date_rules.txt found")
              rules = []
          
          changes_made = False
          
          for rule in rules:
              rule = rule.strip()
              if not rule or rule.startswith('#'):
                  continue
              
              try:
                  parts = rule.split(' ')
                  filename = parts[0]
                  date_str = parts[1]
                  time_str = parts[2] if len(parts) > 2 else "00:00"
                  
                  block_datetime = datetime.datetime.strptime(f"{date_str} {time_str}", '%Y-%m-%d %H:%M')
                  print(f"Checking {filename}: block time {block_datetime} (Iran time)")
                  print(f"Current Iran time: {iran_now}")
                  print(f"Should block? {iran_now >= block_datetime}")
                  
                  if iran_now >= block_datetime:
                      blocked_content = ""
                      try:
                          with open('blocked_users.txt', 'r') as f:
                              blocked_content = f.read()
                          print(f"Current blocked_users.txt content: '{blocked_content.strip()}'")
                      except FileNotFoundError:
                          print("blocked_users.txt not found, will create")
                          pass
                      
                      username = filename.replace('.txt', '')
                      print(f"Username to block: '{username}'")
                      
                      if username not in blocked_content:
                          with open('blocked_users.txt', 'a') as f:
                              f.write(f'{username}\n')
                          print(f'‚úÖ Auto-blocked {username} (from {filename})')
                          changes_made = True
                      else:
                          print(f'‚ö†Ô∏è {username} already blocked')
                  else:
                      time_left = block_datetime - iran_now
                      print(f'‚è≥ {filename} will be blocked in {time_left}')
              except Exception as e:
                  print(f'‚ùå Error processing rule "{rule}": {e}')
                  import traceback
                  traceback.print_exc()
          
          if changes_made:
              print("üìù Changes made to blocked_users.txt")
              # Show the updated content
              try:
                  with open('blocked_users.txt', 'r') as f:
                      content = f.read()
                  print(f"Updated blocked_users.txt content: '{content.strip()}'")
              except:
                  pass
          else:
              print("‚úÖ No time-based blocking needed")
          EOF
